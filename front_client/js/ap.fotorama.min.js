"use strict";angular.module("ap.fotorama",[]).value("apFotoramaConfig",{id:"id",thumb:"thumb",img:"img",full:"full",caption:"caption",active:"active",domain:"",show:null,showend:null,fullscreenenter:null,fullscreenexit:null,loadvideo:null,unloadvideo:null,stagetap:null,ready:null,error:null,load:null,stopautoplay:null,startautoplay:null}).directive("apFotorama",["apFotoramaConfig",function(o){return{require:"?ngModel",link:function(a,i,t){function e(o,a){for(var i,t,e="object"==typeof o?o.length:0,l=0,r=e,u=[];r>l;l++)void 0!==o[l].id?(t=u.push({})-1,u[t].id=o[l][d.id],u[t].thumb=void 0!==o[l][d.thumb]?d.domain+o[l][d.thumb]:o[l][d.thumb],u[t].img=void 0!==o[l][d.img]?d.domain+o[l][d.img]:o[l][d.thumb],u[t].full=void 0!==o[l][d.full]?d.domain+o[l][d.full]:o[l][d.thumb],u[t].html=o[l][d.html],u[t].caption=o[l][d.caption],o[t][d.active]&&(i=t),a&&n.data&&n.splice(l,1,u[l])):e--;return{arr:u,arrLength:e,activeIndex:i}}function l(o){o=void 0===o&&void 0!==this&&void 0!==this.$index?this.$index:o;for(var i=0,e=a[t.ngModel].length;e>i;i++)a[t.ngModel][i][d.active]=o==i?!0:!1}var n,d={},r="show showend fullscreenenter fullscreenexit loadvideo unloadvideo stagetap ready error load stopautoplay startautoplay".split(" ");angular.extend(d,o),i.bind("fotorama:showend",function(){void 0!==n&&"object"==typeof a[t.ngModel]&&(l(n.activeIndex),a.$$phase||a.$apply())}),a.setActive=l,a.$watch(t.ngModel,function(o,i){if(i!==o){var l,r,u,c={},s={},p=n.data?n.data:[],f=p.length,m=n.activeIndex;u=e(o);var v=u.arr,g=u.arrLength,h=u.activeIndex;if(f){for(l=0;f>l;l++)c[p[l].id]=l;for(l=0;g>l;l++)s[v[l].id]=l;for(l=0,r=0;g>l;l++,r++)void 0===p[r]&&(p[r]={id:null}),v[l].id!==p[r].id?(void 0===c[v[l].id]&&(n.splice(l,0,v[l]),r--,console.log("+add")),r>=0&&void 0===s[p[r].id]&&(m==r&&void 0===h&&(h=l!==g?l:l-2),n.splice(l,1),l--,console.log("-del")),l>=0&&void 0!==c[v[l].id]&&void 0!==s[p[r].id]&&(c[v[l].id]-c[p[r].id]>s[p[r].id]-s[v[l].id]?(n.splice(l,0,v[l]),delete s[v[l].id],r--,console.log("add")):(n.splice(l,1),delete c[p[r].id],l--,console.log("del")))):v[l].img!==p[r].img&&(n.splice(l,1,v[l]),console.log("change"));f>r&&n.splice(g,f-r),m>=g&&void 0===h&&(h=g-1)}else g&&n.setOptions(d).load(v).setOptions(a[t.apFotorama]);g&&n.show(void 0!==h?h:0)}},!0),a.$watch(t.apFotorama,function(l){angular.extend(d,o,l),n.setOptions(d),angular.forEach(r,function(o){"function"==typeof d[o]&&i.bind("fotorama:"+o,function(a,i,t){d[o](a,t)})}),(l.thumb||l.img||l.full)&&e(a[t.ngModel],!0)},!0),n=i.fotorama(d).data("fotorama"),a[t.apFotorama]=angular.extend({},n.options,a[t.apFotorama])}}}]);